:root{
  /* ===== базовая гамма ===== */
  --ink: #e9e7ff;
  --muted: rgba(233,231,255,.72);

  /* рама и свинец */
  --frame: #0a0b16;         /* однотонная тёмная рама */
  --lead: rgba(5, 6, 14, .92); /* сетка заметнее */

  /* стекло */
  --glass-tint: rgba(120, 140, 255, .18);
  --glass-tint2: rgba(170, 120, 255, .12);

  /* “вырез”/глубина */
  --shadow-out: rgba(0,0,0,.55);
  --shadow-in: rgba(0,0,0,.55);

  --radius: 18px;
}

*{ box-sizing: border-box; }

body{
  margin: 0;
  font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
  line-height: 1.6;
  color: var(--ink);

  /* ===== фон: бесшовная плитка + лёгкий ночной фильтр =====
     Положи текстуру сюда: assets/bg-tile.png (или .jpg/.webp)
  */
  background:
    /* “ночной фильтр” поверх плитки, чтобы всё не было слишком пёстро */
    radial-gradient(1200px 700px at 18% 12%, rgba(140,120,255,.20), transparent 60%),
    radial-gradient(900px 600px at 78% 18%, rgba(120,170,255,.16), transparent 55%),
    linear-gradient(180deg, rgba(5,6,18,.75), rgba(5,6,18,.88)),
    url("./bg-tile.png");

  background-repeat: repeat;
  background-size: auto; /* если хочешь масштаб: поставь, например, 420px auto */
  background-attachment: fixed;
}

.wrap{
  max-width: 980px;
  margin: 0 auto;
  padding: 28px 16px 56px;
}

/* ===== верх ===== */
.top h1{
  margin: 0 0 6px;
  font-size: clamp(26px, 3.2vw, 40px);
  letter-spacing: .3px;
}

.sub{
  margin: 0 0 22px;
  color: var(--muted);
}

/* ===== окна: без карточки/подложки ===== */
.windows{
  max-width: 90vw;
  margin: 0 auto;

  display: grid;

  /* ключ: авто-колонки фиксированной ширины */
  grid-template-columns: repeat(auto-fit, 250px);

  /* центрируем всю “группу” */
  justify-content: center;

  /* нормальные гэпы */
  gap: 22px;

  align-items: stretch;

  padding: 0;
  border: 0;
  box-shadow: none;
  background: transparent;
}


@media (max-width: 520px){
  .windows{ grid-template-columns: 1fr; justify-items: center; }
  .window{ width: min(220px, 92vw); }
}

/* ===== кликабельная зона окна, без прыжков ===== */
.window{
  width: 250px;      /* фиксируем, чтобы grid работал предсказуемо */
  margin: 0 auto;    /* на всякий случай */
  position: relative;
  display: block;
  aspect-ratio: 3 / 5;
  text-decoration: none;
  outline: none;

  background: transparent;
  border-radius: 0;
  padding: 0;

  filter: drop-shadow(0 18px 38px rgba(0,0,0,.58));
  transition: filter .18s ease, opacity .18s ease;
}

.window:hover{
  /* без translateY, только чуть больше “веса” */
  filter: drop-shadow(0 22px 55px rgba(0,0,0,.70));
}

/* ===== рама (однотонная, тёмная) ===== */
.window::before{
  content: "";
  position: absolute;
  inset: 0;

  /* форма стрельчатой арки */
  clip-path: polygon(
    50% 0%,
    82% 12%,
    100% 32%,
    100% 100%,
    0% 100%,
    0% 32%,
    18% 12%
  );

  border-radius: 16px;

  /* однотонная рама */
  background: var(--frame);

  /* “вырез”: внутренняя тень и небольшой хайлайт по краю */
  box-shadow:
    0 0 0 1px rgba(255,255,255,.12) inset,
    0 22px 42px var(--shadow-in) inset,
    0 2px 0 rgba(255,255,255,.06) inset;
}

/* ===== стекло (картинка пользователя) ===== */
.window .glass{
  position: absolute;
  inset: 12px;
  border-radius: 12px;
  overflow: hidden;

  clip-path: polygon(
    50% 0%,
    82% 12%,
    100% 32%,
    100% 100%,
    0% 100%,
    0% 32%,
    18% 12%
  );

  background:
    linear-gradient(180deg, rgba(255,255,255,.10), rgba(0,0,0,.34)),
    var(--img) center / cover no-repeat;

  filter: saturate(1.08) contrast(1.05);

  /* стекло чуть “глубже” */
  box-shadow:
    0 12px 30px rgba(0,0,0,.62) inset,
    0 0 0 1px rgba(255,255,255,.08) inset;
}

/* ===== сетка/переплёты (сделал заметнее) ===== */
.window .lead{
  position: absolute;
  inset: 12px;
  border-radius: 12px;
  pointer-events: none;

  clip-path: polygon(
    50% 0%,
    82% 12%,
    100% 32%,
    100% 100%,
    0% 100%,
    0% 32%,
    18% 12%
  );

  /* 
    Сетка: более толстые линии + чуть светлый кант по одному краю
    чтобы выглядело “свинцом”, а не плоской чёрной решёткой.
  */
  background:
    /* стекольный тинт */
    linear-gradient(180deg, var(--glass-tint), var(--glass-tint2)),

    /* вертикальные стойки: толще */
    linear-gradient(90deg,
      transparent 0,
      transparent 31.5%,
      var(--lead) 31.5%,
      var(--lead) 34.2%,
      transparent 34.2%,
      transparent 65.8%,
      var(--lead) 65.8%,
      var(--lead) 68.5%,
      transparent 68.5%,
      transparent 100%
    ),

    /* горизонтальные перемычки: толще */
    repeating-linear-gradient(
      180deg,
      transparent 0,
      transparent 17.6%,
      var(--lead) 17.6%,
      var(--lead) 20.0%,
      transparent 20.0%,
      transparent 35.2%
    ),

    /* “кант” (лёгкий светлый край для объёма свинца) */
    linear-gradient(90deg,
      transparent 0,
      transparent 31.5%,
      rgba(255,255,255,.10) 31.5%,
      rgba(255,255,255,.10) 32.1%,
      transparent 32.1%,
      transparent 65.8%,
      rgba(255,255,255,.10) 65.8%,
      rgba(255,255,255,.10) 66.4%,
      transparent 66.4%,
      transparent 100%
    ),

    /* зернистость стекла */
    repeating-linear-gradient(
      45deg,
      rgba(255,255,255,.06) 0 6px,
      rgba(0,0,0,.07) 6px 12px
    );

  /* вместо screen: меньше “вымывания”, больше контраста линий */
  mix-blend-mode: normal;
  opacity: .92;
  transition: opacity .18s ease;
}

.window:hover .lead{
  opacity: 1;
}

/* ===== подпись ===== */
.label{
  position: absolute;
  left: 50%;

  /* ставим верх лейбла на нижнюю границу окна */
  top: 100%;

  /* сдвигаем его так, чтобы середина совпала с границей */
  transform: translate(-50%, -50%);

  width: 70%;
  max-width: 180px;
  padding: 12px 16px;

  text-align: center;
  line-height: 1.25;

  white-space: normal;
  word-break: normal;
  hyphens: auto;

  border-radius: 999px;
  font-weight: 650;
  letter-spacing: .2px;

  background: rgba(10, 11, 22, .72);
  color: rgba(233,231,255,.94);
  border: 1px solid rgba(255,255,255,.14);
  backdrop-filter: blur(8px);
}

/* ===== фокус с клавиатуры ===== */
.window:focus-visible{
  filter:
    drop-shadow(0 22px 55px rgba(0,0,0,.70))
    drop-shadow(0 0 0 rgba(0,0,0,0));
}

.window:focus-visible::before{
  box-shadow:
    0 0 0 2px rgba(140,120,255,.45) inset,
    0 22px 42px rgba(0,0,0,.55) inset,
    0 2px 0 rgba(255,255,255,.06) inset;
}

/* ===== низ ===== */
.bottom{
  margin-top: 18px;
}

.bottom small{
  color: rgba(233,231,255,.55);
}





/* ===== BREAK EFFECT ===== */
.window .glass{
  position: absolute;
  inset: 12px;
  border-radius: 12px;
  overflow: hidden; /* КРИТИЧЕСКИ ВАЖНО */

  clip-path: polygon(
    50% 0%,
    82% 12%,
    100% 32%,
    100% 100%,
    0% 100%,
    0% 32%,
    18% 12%
  );

  box-shadow:
    0 12px 30px rgba(0,0,0,.62) inset,
    0 0 0 1px rgba(255,255,255,.08) inset;
}

.window .img{
  position: absolute;
  inset: 0;

  background:
    linear-gradient(180deg, rgba(255,255,255,.10), rgba(0,0,0,.34)),
    var(--img) center / cover no-repeat;

  transform: scale(1);
  transform-origin: center;

  transition: transform 900ms cubic-bezier(.12, .72, .18, 1);
  will-change: transform;
}

/* Слой “стекла” поверх: трещины + быстрое исчезновение */
.window .lead{
  position: absolute; /* у тебя уже так, но пусть будет */
  opacity: .92;
  transition:
    opacity 220ms ease-out,
    filter 220ms ease-out;
  will-change: opacity, filter;
}

/* Трещины рисуем псевдоэлементом */
.window .lead::after{
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
  opacity: 0;
  transition: opacity 160ms ease-out;

  /* имитация трещин: несколько тонких линий разными углами */
  background:
    repeating-linear-gradient(18deg,
      rgba(255,255,255,.0) 0 10px,
      rgba(255,255,255,.45) 10px 11px,
      rgba(255,255,255,.0) 11px 22px
    ),
    repeating-linear-gradient(-32deg,
      rgba(255,255,255,.0) 0 14px,
      rgba(255,255,255,.35) 14px 15px,
      rgba(255,255,255,.0) 15px 30px
    ),
    radial-gradient(circle at 52% 38%,
      rgba(255,255,255,.55) 0 2px,
      rgba(255,255,255,0) 3px 100%
    );

  mix-blend-mode: screen;
}

/* Активное состояние: трещины на мгновение, потом стекло “исчезает” */
.window.is-broken .lead{
  opacity: 0;
  filter: blur(1px);
}

.window.is-broken .lead::after{
  opacity: 1;
}

/* Картинка внутри: увеличивается до 2х */
.window.is-broken .img{
  transform: scale(2);
}


/* ===== Shards (осколки) ===== */
.window{
  position: relative;
}

/* Контейнер осколков поверх окна */
.window .shards{
  position: absolute;
  inset: 0;
  pointer-events: none;
  overflow: visible; /* осколки должны вылетать наружу */
}

/* Один осколок */
.window .shard{
  position: absolute;

  /* форма осколка */
  width: var(--w, 14px);
  height: var(--h, 18px);
  clip-path: polygon(10% 0%, 100% 18%, 72% 100%, 0% 76%);

  /* внешний вид */
  background: rgba(210, 220, 255, 0.22);
  border: 1px solid rgba(255,255,255,0.22);
  box-shadow: 0 6px 18px rgba(0,0,0,0.35);

  /* анимация полёта */
  transform:
    translate(0,0)
    rotate(var(--r0, 0deg));
  opacity: 1;

  animation: shard-fly 520ms cubic-bezier(.16, .82, .22, 1) forwards;
  will-change: transform, opacity;
}

/* Полёт осколков */
@keyframes shard-fly{
  0%{
    transform: translate(0,0) rotate(var(--r0, 0deg)) scale(1);
    opacity: 1;
  }
  70%{
    opacity: 1;
  }
  100%{
    transform:
      translate(var(--dx, 0px), var(--dy, 0px))
      rotate(var(--r1, 180deg))
      scale(0.9);
    opacity: 0;
  }
}

/* Чуть больше драматизма: когда разбито, сетка исчезает быстрее */
.window.is-broken .lead{
  opacity: 0;
  filter: blur(1px);
}
